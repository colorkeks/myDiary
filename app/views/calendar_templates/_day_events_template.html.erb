 <% events.each do |event| %>
        <% start_date = event.start_date.to_date %>
        <% end_date = event.end_date.to_date %>
        <% start_included = date_range.include?(start_date) %>
        <% end_included = date_range.include?(end_date) %>
        <tr>
          <% if date_range.to_a.include?(start_date) %>
              <% (start_date.cwday - 1).times do %>
                  <td></td>
              <% end %>
          <% end %>

          <!--Если начало и конец на одной неделе-->
          <% if start_included && end_included %>
              <td colspan="<%= end_date.cwday - start_date.cwday + 1 %>">
                <!--Для длительных событый которые занимают всю неделю+ -->
          <% elsif key.include?(date_range.first) && key.include?(date_range.last) %>
              <td colspan="7">
                <!--Если только начало на этой неделе-->
          <% elsif start_included %>
              <% max = 8 - start_date.cwday %>
              <% current = (end_date - start_date).to_i %>
              <td colspan="<%= current > max ? max : current %>">
                <!--Если только конец на этой неделе-->
          <% elsif end_included %>
              <td colspan="<%= end_date.cwday %>">
          <% end %>
          <div class="event"><%= event.title %></div>
          </td>
        </tr>
 <% end %>
